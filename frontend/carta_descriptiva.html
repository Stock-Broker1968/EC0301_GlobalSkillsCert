import React, { useState, useEffect } from 'react';
import { Save, FileText, CheckCircle, AlertCircle, Plus, Trash2, Download, Clock, Users, Target, BookOpen } from 'lucide-react';

const CartaDescriptivaEC0301 = () => {
  const [activeSection, setActiveSection] = useState('info-general');
  const [formData, setFormData] = useState({
    // INFORMACI√ìN GENERAL
    nombreCurso: '',
    facilitador: '',
    lugarInstruccion: '',
    duracionHoras: 2,
    fechas: '',
    perfilParticipante: '',
    numeroParticipantes: 4,
    proposito: '',
    
    // OBJETIVO GENERAL
    objetivoGeneral: {
      cognitivo: '',
      psicomotor: '',
      afectivo: '',
      relacional: '',
      condicion: '',
      generado: ''
    },
    
    // OBJETIVOS PARTICULARES (4 dimensiones)
    objetivosParticulares: [
      {
        dimension: 'COGNITIVO',
        sujeto: 'El Participante',
        accion: '',
        condicion: '',
        temas: '',
        tiempo: 0
      },
      {
        dimension: 'PSICOMOTOR',
        sujeto: 'El Participante',
        accion: '',
        condicion: '',
        temas: '',
        tiempo: 0
      },
      {
        dimension: 'AFECTIVO',
        sujeto: 'El Participante',
        accion: '',
        condicion: '',
        temas: '',
        tiempo: 0
      },
      {
        dimension: 'RELACIONAL/SOCIALES',
        sujeto: 'El Participante',
        accion: '',
        condicion: '',
        temas: '',
        tiempo: 0
      }
    ],
    
    // REQUERIMIENTOS
    requerimientos: {
      instalaciones: '',
      equipo: '',
      materiales: '',
      humanos: '',
      saludSeguridad: ''
    },
    
    // EVALUACI√ìN
    evaluacion: {
      aspectos: [
        { aspecto: 'Evaluaci√≥n Diagn√≥stica', porcentaje: 0, instrumento: 'Cuestionario', momento: 'Al inicio', tipo: 'Heteroevaluaci√≥n' },
        { aspecto: 'Evaluaci√≥n Formativa (intermedia)', porcentaje: 50, instrumento: 'Gu√≠a de observaci√≥n', momento: 'Intermedia', tipo: 'Heteroevaluaci√≥n' },
        { aspecto: 'Evaluaci√≥n Sumativa (final)', porcentaje: 40, instrumento: 'Cuestionario', momento: 'Al final', tipo: 'Heteroevaluaci√≥n' },
        { aspecto: 'Evaluaci√≥n Satisfacci√≥n', porcentaje: 10, instrumento: 'Cuestionario', momento: 'Al final', tipo: 'Heteroevaluaci√≥n' }
      ],
      minimoAprobatorio: 70
    },
    
    // COMPROBACI√ìN
    comprobacion: {
      actividades: '1. Aplicar la lista de verificaci√≥n de requerimientos.\n2. Realizar pruebas de funcionamiento del equipo.\n3. Verificar la distribuci√≥n del mobiliario y equipo.\n4. Verificar la suficiencia de material conforme al n√∫mero de participantes.',
      duracion: 30,
      tecnicas: 'Lista de verificaci√≥n de requerimientos',
      materiales: 'Lista de verificaci√≥n de requerimientos'
    },
    
    // APERTURA/ENCUADRE
    apertura: {
      etapas: [
        {
          nombre: 'Presentaci√≥n del instructor y participantes',
          actividades: '',
          duracion: 0,
          tecnicas: 'Presentaci√≥n, Rompehielo',
          materiales: 'Presentaci√≥n en PowerPoint, laptop, proyector'
        },
        {
          nombre: 'Presentaci√≥n del curso',
          actividades: '',
          duracion: 0,
          tecnicas: 'Expositiva dialogada',
          materiales: 'Presentaci√≥n en PowerPoint, laptop, proyector'
        },
        {
          nombre: 'Momentos e instrumentos de evaluaci√≥n',
          actividades: '',
          duracion: 0,
          tecnicas: 'Expositiva',
          materiales: 'Formatos impresos'
        },
        {
          nombre: 'Acuerdos y compromisos',
          actividades: '',
          duracion: 0,
          tecnicas: 'T√©cnica grupal',
          materiales: 'Rotafolio, marcadores, contratos de aprendizaje'
        },
        {
          nombre: 'Evaluaci√≥n diagn√≥stica',
          actividades: '',
          duracion: 0,
          tecnicas: 'Evaluaci√≥n diagn√≥stica',
          materiales: 'Cuestionario diagn√≥stico, bol√≠grafos'
        }
      ]
    },
    
    // DESARROLLO
    desarrollo: {
      temas: []
    },
    
    // EVALUACI√ìN FORMATIVA (Intermedia)
    evaluacionFormativa: {
      actividades: 'El instructor indica el alcance y estrategias de la evaluaci√≥n: sirve para retroalimentar el avance logrado. Se realiza durante la t√©cnica demostrativa. Aclara dudas.',
      duracion: 0,
      tecnicas: 'Evaluaci√≥n formativa (Gu√≠a de observaci√≥n)',
      materiales: 'Gu√≠a de observaci√≥n, bol√≠grafos'
    },
    
    // ENERGIZANTE/REACTIVACI√ìN
    energizante: {
      actividades: '',
      duracion: 0,
      tecnicas: 'T√©cnica energizante',
      materiales: 'Espacio libre, m√∫sica opcional'
    },
    
    // CIERRE
    cierre: {
      etapas: [
        {
          nombre: 'Conclusiones y resumen',
          actividades: '',
          duracion: 0,
          tecnicas: 'T√©cnica grupal de cierre',
          materiales: 'Pizarr√≥n, laptop, proyector'
        },
        {
          nombre: 'Logro de expectativas y objetivos',
          actividades: '',
          duracion: 0,
          tecnicas: 'T√©cnica grupal',
          materiales: 'Rotafolio, marcadores'
        },
        {
          nombre: 'Sugerencias de continuidad y referencias',
          actividades: '',
          duracion: 0,
          tecnicas: 'Expositiva',
          materiales: 'Presentaci√≥n'
        },
        {
          nombre: 'Evaluaci√≥n de satisfacci√≥n',
          actividades: '',
          duracion: 0,
          tecnicas: 'Evaluaci√≥n de satisfacci√≥n',
          materiales: 'Formatos impresos, bol√≠grafos'
        },
        {
          nombre: 'Despedida y agradecimientos',
          actividades: '',
          duracion: 0,
          tecnicas: 'T√©cnica grupal',
          materiales: '‚Äî'
        }
      ]
    }
  });

  const generarObjetivoGeneral = () => {
    const { cognitivo, psicomotor, afectivo, relacional, condicion } = formData.objetivoGeneral;
    
    if (!cognitivo || !psicomotor || !afectivo || !relacional || !condicion) {
      alert('‚ö†Ô∏è Complete todos los campos para generar el objetivo');
      return;
    }

    const objetivo = `Al finalizar el curso, el participante ${cognitivo}, ${psicomotor}, ${afectivo} y ${relacional}, ${condicion}`;
    
    setFormData(prev => ({
      ...prev,
      objetivoGeneral: { ...prev.objetivoGeneral, generado: objetivo }
    }));
  };

  const agregarTema = () => {
    setFormData(prev => ({
      ...prev,
      desarrollo: {
        temas: [...prev.desarrollo.temas, {
          id: Date.now(),
          nombre: '',
          subtemas: '',
          actividades: '',
          duracion: 0,
          tecnicas: '',
          materiales: ''
        }]
      }
    }));
  };

  const eliminarTema = (id) => {
    setFormData(prev => ({
      ...prev,
      desarrollo: {
        temas: prev.desarrollo.temas.filter(t => t.id !== id)
      }
    }));
  };

  const actualizarTema = (id, campo, valor) => {
    setFormData(prev => ({
      ...prev,
      desarrollo: {
        temas: prev.desarrollo.temas.map(t => 
          t.id === id ? { ...t, [campo]: valor } : t
        )
      }
    }));
  };

  const actualizarObjetivoParticular = (index, campo, valor) => {
    setFormData(prev => ({
      ...prev,
      objetivosParticulares: prev.objetivosParticulares.map((obj, idx) =>
        idx === index ? { ...obj, [campo]: valor } : obj
      )
    }));
  };

  const actualizarEtapaApertura = (index, campo, valor) => {
    setFormData(prev => ({
      ...prev,
      apertura: {
        etapas: prev.apertura.etapas.map((etapa, idx) =>
          idx === index ? { ...etapa, [campo]: valor } : etapa
        )
      }
    }));
  };

  const actualizarEtapaCierre = (index, campo, valor) => {
    setFormData(prev => ({
      ...prev,
      cierre: {
        etapas: prev.cierre.etapas.map((etapa, idx) =>
          idx === index ? { ...etapa, [campo]: valor } : etapa
        )
      }
    }));
  };

  const actualizarEvaluacion = (index, campo, valor) => {
    setFormData(prev => ({
      ...prev,
      evaluacion: {
        ...prev.evaluacion,
        aspectos: prev.evaluacion.aspectos.map((asp, idx) =>
          idx === index ? { ...asp, [campo]: valor } : asp
        )
      }
    }));
  };

  const calcularTiempos = () => {
    const comprobacion = formData.comprobacion.duracion || 0;
    const apertura = formData.apertura.etapas.reduce((sum, e) => sum + (e.duracion || 0), 0);
    const desarrollo = formData.desarrollo.temas.reduce((sum, t) => sum + (t.duracion || 0), 0);
    const formativa = formData.evaluacionFormativa.duracion || 0;
    const energizante = formData.energizante.duracion || 0;
    const cierre = formData.cierre.etapas.reduce((sum, e) => sum + (e.duracion || 0), 0);
    
    return {
      comprobacion,
      apertura,
      desarrollo,
      formativa,
      energizante,
      cierre,
      total: apertura + desarrollo + formativa + energizante + cierre,
      esperado: formData.duracionHoras * 60
    };
  };

  const calcularTotalEvaluacion = () => {
    return formData.evaluacion.aspectos.reduce((sum, asp) => sum + (asp.porcentaje || 0), 0);
  };

  const guardarBorrador = () => {
    try {
      localStorage.setItem('cartaEC0301_v2', JSON.stringify(formData));
      alert('‚úÖ Borrador guardado correctamente');
    } catch (e) {
      alert('‚ùå Error al guardar: ' + e.message);
    }
  };

  const exportarJSON = () => {
    const blob = new Blob([JSON.stringify(formData, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `carta-descriptiva-${formData.nombreCurso || 'sin-nombre'}.json`;
    a.click();
  };

  useEffect(() => {
    const guardado = localStorage.getItem('cartaEC0301_v2');
    if (guardado) {
      try {
        setFormData(JSON.parse(guardado));
      } catch (e) {
        console.error('Error al cargar datos');
      }
    }
  }, []);

  const tiempos = calcularTiempos();
  const totalEvaluacion = calcularTotalEvaluacion();
  const evaluacionValida = totalEvaluacion === 100;
  const tiempoValido = tiempos.total === tiempos.esperado;

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
      {/* HEADER */}
      <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
        <div className="flex items-center justify-between flex-wrap gap-4">
          <div className="flex items-center gap-3">
            <FileText className="w-10 h-10 text-indigo-600" />
            <div>
              <h1 className="text-2xl font-bold text-gray-900">Carta Descriptiva EC0301</h1>
              <p className="text-sm text-gray-600">Sistema Completo para Cursos Presenciales</p>
            </div>
          </div>
          <div className="flex gap-2">
            <button onClick={guardarBorrador} className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
              <Save className="w-4 h-4" /> Guardar
            </button>
            <button onClick={exportarJSON} className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
              <Download className="w-4 h-4" /> Exportar
            </button>
          </div>
        </div>

        {/* INDICADORES */}
        <div className="mt-6 grid md:grid-cols-4 gap-4">
          <div className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border-2 border-blue-200">
            <p className="text-xs text-blue-700 font-semibold mb-1">TIEMPO DEL CURSO</p>
            <p className="text-2xl font-bold text-blue-900">{tiempos.total} / {tiempos.esperado} min</p>
            <p className="text-xs text-blue-600 mt-1">{tiempoValido ? '‚úì Completo' : `Faltan ${tiempos.esperado - tiempos.total} min`}</p>
          </div>
          <div className="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border-2 border-green-200">
            <p className="text-xs text-green-700 font-semibold mb-1">EVALUACI√ìN</p>
            <p className="text-2xl font-bold text-green-900">{totalEvaluacion}%</p>
            <p className="text-xs text-green-600 mt-1">{evaluacionValida ? '‚úì V√°lida (100%)' : '‚úó Debe sumar 100%'}</p>
          </div>
          <div className="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border-2 border-purple-200">
            <p className="text-xs text-purple-700 font-semibold mb-1">TEMAS</p>
            <p className="text-2xl font-bold text-purple-900">{formData.desarrollo.temas.length}</p>
            <p className="text-xs text-purple-600 mt-1">M√≥dulos del curso</p>
          </div>
          <div className="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-4 border-2 border-orange-200">
            <p className="text-xs text-orange-700 font-semibold mb-1">OBJETIVOS</p>
            <p className="text-2xl font-bold text-orange-900">4</p>
            <p className="text-xs text-orange-600 mt-1">Dimensiones completas</p>
          </div>
        </div>
      </div>

      {/* NAVEGACI√ìN */}
      <div className="bg-white rounded-xl shadow-lg mb-6 overflow-x-auto">
        <div className="flex gap-1 p-2">
          {[
            { id: 'info-general', label: '1. Info General', icon: FileText },
            { id: 'objetivo-general', label: '2. Objetivo General', icon: Target },
            { id: 'objetivos-particulares', label: '3. Objetivos Particulares', icon: BookOpen },
            { id: 'requerimientos', label: '4. Requerimientos', icon: Users },
            { id: 'evaluacion', label: '5. Evaluaci√≥n', icon: CheckCircle },
            { id: 'comprobacion', label: '6. Comprobaci√≥n', icon: Clock },
            { id: 'apertura', label: '7. Apertura', icon: Target },
            { id: 'desarrollo', label: '8. Desarrollo', icon: BookOpen },
            { id: 'cierre', label: '9. Cierre', icon: CheckCircle }
          ].map(section => (
            <button
              key={section.id}
              onClick={() => setActiveSection(section.id)}
              className={`flex items-center gap-2 px-4 py-3 rounded-lg font-semibold transition whitespace-nowrap ${
                activeSection === section.id
                  ? 'bg-indigo-600 text-white shadow-lg'
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              <section.icon className="w-4 h-4" />
              {section.label}
            </button>
          ))}
        </div>
      </div>

      {/* CONTENIDO */}
      <div className="space-y-6">
        
        {/* 1. INFORMACI√ìN GENERAL */}
        {activeSection === 'info-general' && (
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h2 className="text-2xl font-bold text-gray-900 mb-6">1. Informaci√≥n General del Curso</h2>
            
            <div className="grid md:grid-cols-2 gap-6">
              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  Nombre del Curso-Taller <span className="text-red-600">*</span>
                </label>
                <input
                  type="text"
                  value={formData.nombreCurso}
                  onChange={(e) => setFormData({...formData, nombreCurso: e.target.value})}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  placeholder="Ej: Curso de Inducci√≥n en PLD y FT"
                />
              </div>

              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  Nombre del Facilitador/Instructor <span className="text-red-600">*</span>
                </label>
                <input
                  type="text"
                  value={formData.facilitador}
                  onChange={(e) => setFormData({...formData, facilitador: e.target.value})}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  placeholder="Nombre completo"
                />
              </div>

              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  Duraci√≥n (horas) <span className="text-red-600">*</span>
                </label>
                <input
                  type="number"
                  value={formData.duracionHoras}
                  onChange={(e) => setFormData({...formData, duracionHoras: parseFloat(e.target.value) || 0})}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  min="0.5"
                  step="0.5"
                />
                <p className="text-xs text-gray-500 mt-1">= {formData.duracionHoras * 60} minutos</p>
              </div>

              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  Fecha(s) <span className="text-red-600">*</span>
                </label>
                <input
                  type="text"
                  value={formData.fechas}
                  onChange={(e) => setFormData({...formData, fechas: e.target.value})}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  placeholder="Ej: 17 julio 2025"
                />
              </div>

              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  N√∫mero de Participantes <span className="text-red-600">*</span>
                </label>
                <input
                  type="number"
                  value={formData.numeroParticipantes}
                  onChange={(e) => setFormData({...formData, numeroParticipantes: parseInt(e.target.value) || 0})}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  min="1"
                />
              </div>
            </div>

            <div className="mt-6">
              <label className="block text-sm font-bold text-gray-700 mb-2">
                Lugar de Instrucci√≥n <span className="text-red-600">*</span>
              </label>
              <textarea
                value={formData.lugarInstruccion}
                onChange={(e) => setFormData({...formData, lugarInstruccion: e.target.value})}
                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                rows="3"
                placeholder="Sal√≥n, Hotel, Direcci√≥n completa..."
              />
            </div>

            <div className="mt-6">
              <label className="block text-sm font-bold text-gray-700 mb-2">
                Perfil del Participante <span className="text-red-600">*</span>
              </label>
              <textarea
                value={formData.perfilParticipante}
                onChange={(e) => setFormData({...formData, perfilParticipante: e.target.value})}
                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                rows="5"
                placeholder="Nivel educativo, experiencia previa, conocimientos, actitudes..."
              />
            </div>

            <div className="mt-6">
              <label className="block text-sm font-bold text-gray-700 mb-2">
                Prop√≥sito/Beneficio del Curso <span className="text-red-600">*</span>
              </label>
              <textarea
                value={formData.proposito}
                onChange={(e) => setFormData({...formData, proposito: e.target.value})}
                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                rows="5"
                placeholder="Describa el prop√≥sito y beneficios del curso..."
              />
            </div>
          </div>
        )}

        {/* 2. OBJETIVO GENERAL */}
        {activeSection === 'objetivo-general' && (
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h2 className="text-2xl font-bold text-gray-900 mb-6">2. Objetivo General (4 Dimensiones Integradas)</h2>
            
            <div className="bg-blue-50 border-l-4 border-blue-600 p-4 rounded-lg mb-6">
              <p className="text-sm font-semibold text-blue-900 mb-2">üìò Estructura del Objetivo General:</p>
              <p className="text-sm text-blue-800">
                <strong>Sujeto (fijo):</strong> "Al finalizar el curso, el participante"<br/>
                <strong>Acci√≥n integrada:</strong> [Cognitivo] + [Psicomotor] + [Afectivo] + [Relacional]<br/>
                <strong>Condici√≥n:</strong> Contexto y finalidad
              </p>
            </div>

            <div className="space-y-6">
              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  üß† Dimensi√≥n Cognitiva <span className="text-red-600">*</span>
                </label>
                <input
                  type="text"
                  value={formData.objetivoGeneral.cognitivo}
                  onChange={(e) => setFormData({
                    ...formData,
                    objetivoGeneral: { ...formData.objetivoGeneral, cognitivo: e.target.value }
                  })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  placeholder="identificar√° y describir√° las principales normativas..."
                />
              </div>

              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  ‚úã Dimensi√≥n Psicomotora <span className="text-red-600">*</span>
                </label>
                <input
                  type="text"
                  value={formData.objetivoGeneral.psicomotor}
                  onChange={(e) => setFormData({
                    ...formData,
                    objetivoGeneral: { ...formData.objetivoGeneral, psicomotor: e.target.value }
                  })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  placeholder="aplicar√° correctamente los procedimientos..."
                />
              </div>

              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  ‚ù§Ô∏è Dimensi√≥n Afectiva <span className="text-red-600">*</span>
                </label>
                <input
                  type="text"
                  value={formData.objetivoGeneral.afectivo}
                  onChange={(e) => setFormData({
                    ...formData,
                    objetivoGeneral: { ...formData.objetivoGeneral, afectivo: e.target.value }
                  })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  placeholder="asumir√° una actitud proactiva y √©tica..."
                />
              </div>

              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  ü§ù Dimensi√≥n Relacional <span className="text-red-600">*</span>
                </label>
                <input
                  type="text"
                  value={formData.objetivoGeneral.relacional}
                  onChange={(e) => setFormData({
                    ...formData,
                    objetivoGeneral: { ...formData.objetivoGeneral, relacional: e.target.value }
                  })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  placeholder="colaborar√° en equipo para identificar riesgos..."
                />
              </div>

              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  üìã Condici√≥n de Operaci√≥n <span className="text-red-600">*</span>
                </label>
                <textarea
                  value={formData.objetivoGeneral.condicion}
                  onChange={(e) => setFormData({
                    ...formData,
                    objetivoGeneral: { ...formData.objetivoGeneral, condicion: e.target.value }
                  })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  rows="4"
                  placeholder="aplicando estos conocimientos a casos pr√°cticos, con el prop√≥sito de fortalecer la cultura de cumplimiento y reducir riesgos institucionales"
                />
              </div>

              <button
                onClick={generarObjetivoGeneral}
                className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 rounded-lg font-bold text-lg hover:from-indigo-700 hover:to-purple-700 transition flex items-center justify-center gap-3"
              >
                <CheckCircle className="w-6 h-6" />
                Generar Objetivo General Completo
              </button>

              {formData.objetivoGeneral.generado && (
                <div className="bg-gradient-to-br from-indigo-50 to-purple-50 border-l-4 border-indigo-600 p-6 rounded-lg">
                  <p className="text-sm font-bold text-indigo-900 mb-3">‚ú® OBJETIVO GENERAL GENERADO:</p>
                  <p className="text-gray-900 leading-relaxed text-lg italic font-medium">{formData.objetivoGeneral.generado}</p>
                </div>
              )}
            </div>
          </div>
        )}

        {/* 3. OBJETIVOS PARTICULARES */}
        {activeSection === 'objetivos-particulares' && (
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h2 className="text-2xl font-bold text-gray-900 mb-6">3. Objetivos Particulares (4 Dimensiones)</h2>

            {formData.objetivosParticulares.map((obj, idx) => (
              <div key={idx} className="mb-6 border-2 border-gray-200 rounded-xl p-6 bg-gradient-to-br from-gray-50 to-white">
                <div className="flex items-center gap-3 mb-4">
                  <div className={`w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-xl ${
                    obj.dimension === 'COGNITIVO' ? 'bg-blue-600' :
                    obj.dimension === 'PSICOMOTOR' ? 'bg-green-600' :
                    obj.dimension === 'AFECTIVO' ? 'bg-yellow-600' : 'bg-purple-600'
                  }`}>
                    {idx + 1}
                  </div>
                  <h3 className="text-xl font-bold text-gray-900">{obj.dimension}</h3>
                </div>

                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">
                      Sujeto (predefinido)
                    </label>
                    <input
                      type="text"
                      value={obj.sujeto}
                      disabled
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-100 text-gray-600"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">
                      Acci√≥n o comportamiento <span className="text-red-600">*</span>
                    </label>
                    <textarea
                      value={obj.accion}
                      onChange={(e) => actualizarObjetivoParticular(idx, 'accion', e.target.value)}
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                      rows="3"
                      placeholder={
                        obj.dimension === 'COGNITIVO' ? 'Al finalizar el curso, identificar√° y explicar√° las principales normativas...' :
                        obj.dimension === 'PSICOMOTOR' ? 'Al finalizar el curso, aplicar√° correctamente los procedimientos...' :
                        obj.dimension === 'AFECTIVO' ? 'Al finalizar el curso, asumir√° una actitud proactiva y √©tica...' :
                        'Durante el curso, colaborar√° en equipo para identificar se√±ales de alerta...'
                      }
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">
                      Condici√≥n de operaci√≥n <span className="text-red-600">*</span>
                    </label>
                    <textarea
                      value={obj.condicion}
                      onChange={(e) => actualizarObjetivoParticular(idx, 'condicion', e.target.value)}
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                      rows="3"
                      placeholder="A trav√©s de... mediante... con la finalidad de..."
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">
                      Temas <span className="text-red-600">*</span>
                    </label>
                    <textarea
                      value={obj.temas}
                      onChange={(e) => actualizarObjetivoParticular(idx, 'temas', e.target.value)}
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                      rows="3"
                      placeholder="- Tema 1&#10;- Tema 2&#10;- Tema 3"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">
                      Tiempo estimado (minutos)
                    </label>
                    <input
                      type="number"
                      value={obj.tiempo}
                      onChange={(e) => actualizarObjetivoParticular(idx, 'tiempo', parseInt(e.target.value) || 0)}
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                      min="0"
                    />
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}

        {/* 4. REQUERIMIENTOS */}
        {activeSection === 'requerimientos' && (
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h2 className="text-2xl font-bold text-gray-900 mb-6">4. Requerimientos (Estructura EC0301)</h2>

            <div className="space-y-6">
              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  Requerimientos en instalaciones, mobiliario y su distribuci√≥n <span className="text-red-600">*</span>
                </label>
                <textarea
                  value={formData.requerimientos.instalaciones}
                  onChange={(e) => setFormData({
                    ...formData,
                    requerimientos: { ...formData.requerimientos, instalaciones: e.target.value }
                  })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  rows="5"
                  placeholder="Ej: Sal√≥n para 5 personas, mesas, sillas, ventilaci√≥n, iluminaci√≥n, distribuci√≥n en U..."
                />
              </div>

              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  Requerimientos en equipo de apoyo y su distribuci√≥n <span className="text-red-600">*</span>
                </label>
                <textarea
                  value={formData.requerimientos.equipo}
                  onChange={(e) => setFormData({
                    ...formData,
                    requerimientos: { ...formData.requerimientos, equipo: e.target.value }
                  })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  rows="5"
                  placeholder="Ej: Laptop, proyector, pantalla, bocina, pizarr√≥n, marcadores, extensi√≥n..."
                />
              </div>

              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  Requerimientos en materiales de apoyo <span className="text-red-600">*</span>
                </label>
                <textarea
                  value={formData.requerimientos.materiales}
                  onChange={(e) => setFormData({
                    ...formData,
                    requerimientos: { ...formData.requerimientos, materiales: e.target.value }
                  })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  rows="6"
                  placeholder="Ej: Formatos de evaluaci√≥n, manuales, contratos, lista de asistencia..."
                />
              </div>

              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  Requerimientos humanos <span className="text-red-600">*</span>
                </label>
                <textarea
                  value={formData.requerimientos.humanos}
                  onChange={(e) => setFormData({
                    ...formData,
                    requerimientos: { ...formData.requerimientos, humanos: e.target.value }
                  })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  rows="3"
                  placeholder="Ej: Instructor certificado, personal de apoyo log√≠stico..."
                />
              </div>

              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  Material y equipo para las medidas de salud/seguridad/higiene/protecci√≥n civil <span className="text-red-600">*</span>
                </label>
                <textarea
                  value={formData.requerimientos.saludSeguridad}
                  onChange={(e) => setFormData({
                    ...formData,
                    requerimientos: { ...formData.requerimientos, saludSeguridad: e.target.value }
                  })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  rows="5"
                  placeholder="Ej: Gel antibacterial, aerosol desinfectante, botiqu√≠n, se√±alizaci√≥n, extintor..."
                />
              </div>
            </div>
          </div>
        )}

        {/* 5. EVALUACI√ìN */}
        {activeSection === 'evaluacion' && (
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h2 className="text-2xl font-bold text-gray-900 mb-6">5. Sistema de Evaluaci√≥n</h2>

            <div className="bg-amber-50 border-l-4 border-amber-600 p-4 rounded-lg mb-6">
              <p className="text-sm font-bold text-amber-900">
                ‚ö†Ô∏è Total actual: {totalEvaluacion}% {evaluacionValida ? '‚úÖ V√ÅLIDO' : '‚ùå DEBE SUMAR 100%'}
              </p>
              <p className="text-xs text-amber-800 mt-1">
                Si el participante cumple con al menos el {formData.evaluacion.minimoAprobatorio}% de la calificaci√≥n total, se considerar√° aprobado.
              </p>
            </div>

            <div className="mb-6">
              <label className="block text-sm font-bold text-gray-700 mb-2">
                Calificaci√≥n M√≠nima Aprobatoria (%)
              </label>
              <select
                value={formData.evaluacion.minimoAprobatorio}
                onChange={(e) => setFormData({
                  ...formData,
                  evaluacion: { ...formData.evaluacion, minimoAprobatorio: parseInt(e.target.value) }
                })}
                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
              >
                <option value="60">60%</option>
                <option value="70">70%</option>
                <option value="80">80%</option>
                <option value="90">90%</option>
              </select>
            </div>

            <div className="overflow-x-auto">
              <table className="w-full border-collapse">
                <thead>
                  <tr className="bg-indigo-600 text-white">
                    <th className="border border-indigo-700 px-4 py-3 text-left">Aspecto por evaluar</th>
                    <th className="border border-indigo-700 px-4 py-3 text-center">Porcentaje</th>
                    <th className="border border-indigo-700 px-4 py-3 text-left">Instrumento de evaluaci√≥n</th>
                    <th className="border border-indigo-700 px-4 py-3 text-left">Momento de aplicaci√≥n</th>
                    <th className="border border-indigo-700 px-4 py-3 text-left">Tipo de evaluaci√≥n</th>
                  </tr>
                </thead>
                <tbody>
                  {formData.evaluacion.aspectos.map((asp, idx) => (
                    <tr key={idx} className={idx % 2 === 0 ? 'bg-gray-50' : 'bg-white'}>
                      <td className="border border-gray-300 px-4 py-3 font-semibold">{asp.aspecto}</td>
                      <td className="border border-gray-300 px-4 py-3">
                        <input
                          type="number"
                          value={asp.porcentaje}
                          onChange={(e) => actualizarEvaluacion(idx, 'porcentaje', parseInt(e.target.value) || 0)}
                          className="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none text-center"
                          min="0"
                          max="100"
                        />
                      </td>
                      <td className="border border-gray-300 px-4 py-3">
                        <input
                          type="text"
                          value={asp.instrumento}
                          onChange={(e) => actualizarEvaluacion(idx, 'instrumento', e.target.value)}
                          className="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                        />
                      </td>
                      <td className="border border-gray-300 px-4 py-3">
                        <input
                          type="text"
                          value={asp.momento}
                          onChange={(e) => actualizarEvaluacion(idx, 'momento', e.target.value)}
                          className="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                        />
                      </td>
                      <td className="border border-gray-300 px-4 py-3">
                        <select
                          value={asp.tipo}
                          onChange={(e) => actualizarEvaluacion(idx, 'tipo', e.target.value)}
                          className="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                        >
                          <option value="Heteroevaluaci√≥n">Heteroevaluaci√≥n</option>
                          <option value="Autoevaluaci√≥n">Autoevaluaci√≥n</option>
                          <option value="Coevaluaci√≥n">Coevaluaci√≥n</option>
                        </select>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        )}

        {/* 6. COMPROBACI√ìN */}
        {activeSection === 'comprobacion' && (
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h2 className="text-2xl font-bold text-gray-900 mb-6">6. Comprobaci√≥n de Recursos (Previo al curso)</h2>

            <div className="bg-blue-50 border-l-4 border-blue-600 p-4 rounded-lg mb-6">
              <p className="text-sm font-semibold text-blue-900">
                ‚ÑπÔ∏è Esta etapa se realiza {formData.comprobacion.duracion} minutos previos al inicio del curso
              </p>
            </div>

            <div className="space-y-4">
              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  Actividades <span className="text-red-600">*</span>
                </label>
                <textarea
                  value={formData.comprobacion.actividades}
                  onChange={(e) => setFormData({
                    ...formData,
                    comprobacion: { ...formData.comprobacion, actividades: e.target.value }
                  })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  rows="6"
                />
              </div>

              <div className="grid md:grid-cols-3 gap-4">
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-2">Duraci√≥n (min)</label>
                  <input
                    type="number"
                    value={formData.comprobacion.duracion}
                    onChange={(e) => setFormData({
                      ...formData,
                      comprobacion: { ...formData.comprobacion, duracion: parseInt(e.target.value) || 0 }
                    })}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                    min="0"
                  />
                </div>
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-2">T√©cnicas Grupales/Instruccionales</label>
                  <input
                    type="text"
                    value={formData.comprobacion.tecnicas}
                    onChange={(e) => setFormData({
                      ...formData,
                      comprobacion: { ...formData.comprobacion, tecnicas: e.target.value }
                    })}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  />
                </div>
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-2">Material y Equipo de Apoyo</label>
                  <input
                    type="text"
                    value={formData.comprobacion.materiales}
                    onChange={(e) => setFormData({
                      ...formData,
                      comprobacion: { ...formData.comprobacion, materiales: e.target.value }
                    })}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                  />
                </div>
              </div>
            </div>
          </div>
        )}

        {/* 7. APERTURA */}
        {activeSection === 'apertura' && (
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h2 className="text-2xl font-bold text-gray-900 mb-6">7. Apertura/Encuadre del Curso</h2>

            <div className="bg-green-50 border-l-4 border-green-600 p-4 rounded-lg mb-6">
              <p className="text-sm font-semibold text-green-900">
                ‚è±Ô∏è Total de tiempo de apertura: {tiempos.apertura} minutos
              </p>
            </div>

            {formData.apertura.etapas.map((etapa, idx) => (
              <div key={idx} className="mb-6 border-2 border-gray-200 rounded-xl p-5 bg-gray-50">
                <h3 className="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                  <span className="bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm">
                    {idx + 1}
                  </span>
                  {etapa.nombre}
                </h3>

                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">Actividades</label>
                    <textarea
                      value={etapa.actividades}
                      onChange={(e) => actualizarEtapaApertura(idx, 'actividades', e.target.value)}
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                      rows="4"
                      placeholder="Describa las actividades de esta etapa..."
                    />
                  </div>

                  <div className="grid md:grid-cols-3 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-gray-700 mb-2">Duraci√≥n (min)</label>
                      <input
                        type="number"
                        value={etapa.duracion}
                        onChange={(e) => actualizarEtapaApertura(idx, 'duracion', parseInt(e.target.value) || 0)}
                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                        min="0"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-gray-700 mb-2">T√©cnicas</label>
                      <input
                        type="text"
                        value={etapa.tecnicas}
                        onChange={(e) => actualizarEtapaApertura(idx, 'tecnicas', e.target.value)}
                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-gray-700 mb-2">Material y Equipo</label>
                      <input
                        type="text"
                        value={etapa.materiales}
                        onChange={(e) => actualizarEtapaApertura(idx, 'materiales', e.target.value)}
                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                      />
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}

        {/* 8. DESARROLLO */}
        {activeSection === 'desarrollo' && (
          <div className="bg-white rounded-xl shadow-lg p-6">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-2xl font-bold text-gray-900">8. Desarrollo del Curso (Temas/M√≥dulos)</h2>
              <button
                onClick={agregarTema}
                className="flex items-center gap-2 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-semibold"
              >
                <Plus className="w-5 h-5" /> Agregar Tema
              </button>
            </div>

            <div className="bg-purple-50 border-l-4 border-purple-600 p-4 rounded-lg mb-6">
              <p className="text-sm font-semibold text-purple-900">
                üìö Total de tiempo de desarrollo: {tiempos.desarrollo} minutos
              </p>
            </div>

            {formData.desarrollo.temas.length === 0 && (
              <div className="text-center py-12 text-gray-500">
                <BookOpen className="w-16 h-16 mx-auto mb-4 text-gray-400" />
                <p className="text-lg font-semibold">No hay temas agregados</p>
                <p className="text-sm mt-2">Haz clic en "Agregar Tema" para comenzar</p>
              </div>
            )}

            {formData.desarrollo.temas.map((tema, idx) => (
              <div key={tema.id} className="mb-6 border-2 border-gray-200 rounded-xl p-5 bg-gradient-to-br from-blue-50 to-white">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-xl font-bold text-gray-900">Tema/M√≥dulo {idx + 1}</h3>
                  <button
                    onClick={() => eliminarTema(tema.id)}
                    className="flex items-center gap-2 px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition"
                  >
                    <Trash2 className="w-4 h-4" /> Eliminar
                  </button>
                </div>

                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">Nombre del Tema</label>
                    <input
                      type="text"
                      value={tema.nombre}
                      onChange={(e) => actualizarTema(tema.id, 'nombre', e.target.value)}
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                      placeholder="Ej: Introducci√≥n a la PLD/FT y marco normativo"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">Subtemas</label>
                    <textarea
                      value={tema.subtemas}
                      onChange={(e) => actualizarTema(tema.id, 'subtemas', e.target.value)}
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                      rows="3"
                      placeholder="- Conceptos b√°sicos&#10;- Importancia y riesgos&#10;- Principales leyes y autoridades"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">Actividades</label>
                    <textarea
                      value={tema.actividades}
                      onChange={(e) => actualizarTema(tema.id, 'actividades', e.target.value)}
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                      rows="5"
                      placeholder="Describa las actividades de aprendizaje..."
                    />
                  </div>

                  <div className="grid md:grid-cols-3 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-gray-700 mb-2">Duraci√≥n (min)</label>
                      <input
                        type="number"
                        value={tema.duracion}
                        onChange={(e) => actualizarTema(tema.id, 'duracion', parseInt(e.target.value) || 0)}
                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                        min="0"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-gray-700 mb-2">T√©cnicas Grupales/Instruccionales</label>
                      <input
                        type="text"
                        value={tema.tecnicas}
                        onChange={(e) => actualizarTema(tema.id, 'tecnicas', e.target.value)}
                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                        placeholder="Ej: Expositiva dialogada"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-gray-700 mb-2">Material y Equipo de Apoyo</label>
                      <input
                        type="text"
                        value={tema.materiales}
                        onChange={(e) => actualizarTema(tema.id, 'materiales', e.target.value)}
                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                        placeholder="Ej: PowerPoint, laptop, proyector"
                      />
                    </div>
                  </div>
                </div>
              </div>
            ))}

            {/* EVALUACI√ìN FORMATIVA */}
            <div className="mt-8 border-2 border-yellow-400 rounded-xl p-5 bg-gradient-to-br from-yellow-50 to-white">
              <h3 className="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                <CheckCircle className="w-6 h-6 text-yellow-600" />
                Evaluaci√≥n Formativa (Intermedia)
              </h3>

              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-2">Actividades</label>
                  <textarea
                    value={formData.evaluacionFormativa.actividades}
                    onChange={(e) => setFormData({
                      ...formData,
                      evaluacionFormativa: { ...formData.evaluacionFormativa, actividades: e.target.value }
                    })}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                    rows="4"
                  />
                </div>

                <div className="grid md:grid-cols-3 gap-4">
                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">Duraci√≥n (min)</label>
                    <input
                      type="number"
                      value={formData.evaluacionFormativa.duracion}
                      onChange={(e) => setFormData({
                        ...formData,
                        evaluacionFormativa: { ...formData.evaluacionFormativa, duracion: parseInt(e.target.value) || 0 }
                      })}
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                      min="0"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">T√©cnicas</label>
                    <input
                      type="text"
                      value={formData.evaluacionFormativa.tecnicas}
                      onChange={(e) => setFormData({
                        ...formData,
                        evaluacionFormativa: { ...formData.evaluacionFormativa, tecnicas: e.target.value }
                      })}
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">Material y Equipo</label>
                    <input
                      type="text"
                      value={formData.evaluacionFormativa.materiales}
                      onChange={(e) => setFormData({
                        ...formData,
                        evaluacionFormativa: { ...formData.evaluacionFormativa, materiales: e.target.value }
                      })}
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                    />
                  </div>
                </div>
              </div>
            </div>

            {/* ENERGIZANTE/REACTIVACI√ìN */}
            <div className="mt-6 border-2 border-orange-400 rounded-xl p-5 bg-gradient-to-br from-orange-50 to-white">
              <h3 className="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                <AlertCircle className="w-6 h-6 text-orange-600" />
                Energizante / Reactivaci√≥n
              </h3>

              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-2">Actividades</label>
                  <textarea
                    value={formData.energizante.actividades}
                    onChange={(e) => setFormData({
                      ...formData,
                      energizante: { ...formData.energizante, actividades: e.target.value }
                    })}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                    rows="3"
                    placeholder="Ej: T√©cnica 'Jumping Compliance': los participantes se mueven y comparten conceptos clave..."
                  />
                </div>

                <div className="grid md:grid-cols-3 gap-4">
                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">Duraci√≥n (min)</label>
                    <input
                      type="number"
                      value={formData.energizante.duracion}
                      onChange={(e) => setFormData({
                        ...formData,
                        energizante: { ...formData.energizante, duracion: parseInt(e.target.value) || 0 }
                      })}
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                      min="0"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">T√©cnicas</label>
                    <input
                      type="text"
                      value={formData.energizante.tecnicas}
                      onChange={(e) => setFormData({
                        ...formData,
                        energizante: { ...formData.energizante, tecnicas: e.target.value }
                      })}
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">Material y Equipo</label>
                    <input
                      type="text"
                      value={formData.energizante.materiales}
                      onChange={(e) => setFormData({
                        ...formData,
                        energizante: { ...formData.energizante, materiales: e.target.value }
                      })}
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* 9. CIERRE */}
        {activeSection === 'cierre' && (
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h2 className="text-2xl font-bold text-gray-900 mb-6">9. Cierre del Curso</h2>

            <div className="bg-red-50 border-l-4 border-red-600 p-4 rounded-lg mb-6">
              <p className="text-sm font-semibold text-red-900">
                üèÅ Total de tiempo de cierre: {tiempos.cierre} minutos
              </p>
            </div>

            {formData.cierre.etapas.map((etapa, idx) => (
              <div key={idx} className="mb-6 border-2 border-gray-200 rounded-xl p-5 bg-gray-50">
                <h3 className="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                  <span className="bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm">
                    {idx + 1}
                  </span>
                  {etapa.nombre}
                </h3>

                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">Actividades</label>
                    <textarea
                      value={etapa.actividades}
                      onChange={(e) => actualizarEtapaCierre(idx, 'actividades', e.target.value)}
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                      rows="4"
                      placeholder="Describa las actividades de esta etapa..."
                    />
                  </div>

                  <div className="grid md:grid-cols-3 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-gray-700 mb-2">Duraci√≥n (min)</label>
                      <input
                        type="number"
                        value={etapa.duracion}
                        onChange={(e) => actualizarEtapaCierre(idx, 'duracion', parseInt(e.target.value) || 0)}
                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                        min="0"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-gray-700 mb-2">T√©cnicas</label>
                      <input
                        type="text"
                        value={etapa.tecnicas}
                        onChange={(e) => actualizarEtapaCierre(idx, 'tecnicas', e.target.value)}
                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-gray-700 mb-2">Material y Equipo</label>
                      <input
                        type="text"
                        value={etapa.materiales}
                        onChange={(e) => actualizarEtapaCierre(idx, 'materiales', e.target.value)}
                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                      />
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>

      {/* RESUMEN FINAL */}
      <div className="bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl shadow-xl p-8 mt-8">
        <h2 className="text-3xl font-bold mb-6 flex items-center gap-3">
          <CheckCircle className="w-8 h-8" />
          Resumen de Validaci√≥n
        </h2>

        <div className="grid md:grid-cols-2 gap-6 mb-8">
          <div className="bg-white bg-opacity-20 backdrop-blur rounded-xl p-6">
            <h3 className="text-lg font-bold mb-4">‚è±Ô∏è Distribuci√≥n de Tiempos</h3>
            <div className="space-y-2 text-sm">
              <div className="flex justify-between">
                <span>Comprobaci√≥n:</span>
                <span className="font-bold">{tiempos.comprobacion} min</span>
              </div>
              <div className="flex justify-between">
                <span>Apertura:</span>
                <span className="font-bold">{tiempos.apertura} min</span>
              </div>
              <div className="flex justify-between">
                <span>Desarrollo:</span>
                <span className="font-bold">{tiempos.desarrollo} min</span>
              </div>
              <div className="flex justify-between">
                <span>Eval. Formativa:</span>
                <span className="font-bold">{tiempos.formativa} min</span>
              </div>
              <div className="flex justify-between">
                <span>Energizante:</span>
                <span className="font-bold">{tiempos.energizante} min</span>
              </div>
              <div className="flex justify-between">
                <span>Cierre:</span>
                <span className="font-bold">{tiempos.cierre} min</span>
              </div>
              <div className="border-t-2 border-white border-opacity-40 pt-2 mt-2">
                <div className="flex justify-between text-lg font-bold">
                  <span>TOTAL:</span>
                  <span>{tiempos.total} / {tiempos.esperado} min</span>
                </div>
                {tiempoValido ? (
                  <p className="text-xs mt-1 text-green-200">‚úì Tiempo exacto cumplido</p>
                ) : (
                  <p className="text-xs mt-1 text-yellow-200">‚ö†Ô∏è Ajustar: {tiempos.total > tiempos.esperado ? 'Reducir' : 'Aumentar'} {Math.abs(tiempos.total - tiempos.esperado)} minutos</p>
                )}
              </div>
            </div>
          </div>

          <div className="bg-white bg-opacity-20 backdrop-blur rounded-xl p-6">
            <h3 className="text-lg font-bold mb-4">üìä Sistema de Evaluaci√≥n</h3>
            <div className="space-y-2 text-sm">
              {formData.evaluacion.aspectos.map((asp, idx) => (
                <div key={idx} className="flex justify-between">
                  <span className="truncate mr-2">{asp.aspecto.split(' ')[1]}:</span>
                  <span className="font-bold">{asp.porcentaje}%</span>
                </div>
              ))}
              <div className="border-t-2 border-white border-opacity-40 pt-2 mt-2">
                <div className="flex justify-between text-lg font-bold">
                  <span>TOTAL:</span>
                  <span>{totalEvaluacion}%</span>
                </div>
                {evaluacionValida ? (
                  <p className="text-xs mt-1 text-green-200">‚úì Suma correcta (100%)</p>
                ) : (
                  <p className="text-xs mt-1 text-red-200">‚úó Debe sumar exactamente 100%</p>
                )}
              </div>
            </div>
          </div>
        </div>

        <div className="bg-white bg-opacity-20 backdrop-blur rounded-xl p-6">
          <h3 className="text-lg font-bold mb-4">‚úÖ Lista de Verificaci√≥n</h3>
          <div className="grid md:grid-cols-2 gap-4 text-sm">
            <div className="flex items-center gap-3">
              {formData.nombreCurso ? <CheckCircle className="w-5 h-5 text-green-300" /> : <AlertCircle className="w-5 h-5 text-red-300" />}
              <span>Informaci√≥n General Completa</span>
            </div>
            <div className="flex items-center gap-3">
              {formData.objetivoGeneral.generado ? <CheckCircle className="w-5 h-5 text-green-300" /> : <AlertCircle className="w-5 h-5 text-red-300" />}
              <span>Objetivo General Generado</span>
            </div>
            <div className="flex items-center gap-3">
              {formData.objetivosParticulares.every(o => o.accion && o.condicion) ? <CheckCircle className="w-5 h-5 text-green-300" /> : <AlertCircle className="w-5 h-5 text-red-300" />}
              <span>4 Objetivos Particulares</span>
            </div>
            <div className="flex items-center gap-3">
              {formData.requerimientos.instalaciones ? <CheckCircle className="w-5 h-5 text-green-300" /> : <AlertCircle className="w-5 h-5 text-red-300" />}
              <span>Requerimientos Definidos</span>
            </div>
            <div className="flex items-center gap-3">
              {evaluacionValida ? <CheckCircle className="w-5 h-5 text-green-300" /> : <AlertCircle className="w-5 h-5 text-red-300" />}
              <span>Evaluaci√≥n V√°lida (100%)</span>
            </div>
            <div className="flex items-center gap-3">
              {formData.desarrollo.temas.length > 0 ? <CheckCircle className="w-5 h-5 text-green-300" /> : <AlertCircle className="w-5 h-5 text-red-300" />}
              <span>Temas del Desarrollo</span>
            </div>
            <div className="flex items-center gap-3">
              {tiempos.apertura > 0 ? <CheckCircle className="w-5 h-5 text-green-300" /> : <AlertCircle className="w-5 h-5 text-red-300" />}
              <span>Apertura con Tiempos</span>
            </div>
            <div className="flex items-center gap-3">
              {tiempos.cierre > 0 ? <CheckCircle className="w-5 h-5 text-green-300" /> : <AlertCircle className="w-5 h-5 text-red-300" />}
              <span>Cierre con Tiempos</span>
            </div>
            <div className="flex items-center gap-3">
              {tiempoValido ? <CheckCircle className="w-5 h-5 text-green-300" /> : <AlertCircle className="w-5 h-5 text-red-300" />}
              <span>Tiempo Total Exacto</span>
            </div>
            <div className="flex items-center gap-3">
              {formData.evaluacionFormativa.duracion > 0 ? <CheckCircle className="w-5 h-5 text-green-300" /> : <AlertCircle className="w-5 h-5 text-red-300" />}
              <span>Evaluaci√≥n Formativa</span>
            </div>
          </div>
        </div>

        <div className="mt-8 bg-white bg-opacity-20 backdrop-blur rounded-xl p-6">
          <h3 className="text-lg font-bold mb-3">üéØ Pr√≥ximos Pasos:</h3>
          <ul className="space-y-2 text-sm">
            <li>‚Ä¢ Completar todos los campos obligatorios (*)</li>
            <li>‚Ä¢ Asegurar que la evaluaci√≥n sume exactamente 100%</li>
            <li>‚Ä¢ Verificar que el tiempo total coincida con la duraci√≥n del encabezado</li>
            <li>‚Ä¢ Revisar que cada etapa tenga actividades, tiempos, t√©cnicas y materiales</li>
            <li>‚Ä¢ Exportar la carta descriptiva en formato JSON</li>
            <li>‚Ä¢ Generar los productos derivados (manuales, evaluaciones, contratos, listas)</li>
          </ul>
        </div>
      </div>

      {/* Footer */}
      <div className="mt-8 text-center text-sm text-gray-600 pb-8">
        <p className="font-semibold">Sistema de Carta Descriptiva EC0301 - Dise√±o Instruccional Presencial</p>
        <p className="mt-2">Los datos se guardan autom√°ticamente en tu navegador cada vez que presionas "Guardar"</p>
        <p className="mt-1 text-xs text-gray-500">Desarrollado con est√°ndares EC0301 para cursos de capacitaci√≥n presencial</p>
      </div>
    </div>
  );
};

export default CartaDescriptivaEC0301;
